<h1><%= @opening.title %></h1>

<p><%= @opening.description %></p>

<% if current_user.admin? %>
    <ul>
      <li><%= link_to "Edit", edit_opening_path(@opening) %></li>
    </ul>

    <ul>
      <li><%= link_to "Delete", opening_path(@opening), 
                      method: :delete,
                      data: { confirm: "Are you sure?" } %></li>
    </ul>

        <% @users = Opportunity.where(:opid =>@opening.id) %>
        <% if !@users.empty? %>
          <table>
            <thead>
              <tr>
                <th>Name</th>
                <th>Gender</th>
                <th>Age</th>
                <th>Status</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              <% @users.each do |u| %>
                <% @userid = u.uid %>
                <% @temp=Opportunity.find_by(opid:@opening.id,uid:@userid).status%>
                <tr>
                  <td><%= Userdetail.find(@userid).name %> </td>
                  <td><%= Userdetail.find(@userid).gender %> </td>
                  <td><%= Userdetail.find(@userid).age %> </td>
                  <% if !@temp %>
                    <td>Pending</td>
                  <% else %>
                    <td>Approved</td>
                  <% end %>
                  <td><%= link_to "View Details", showDetails_path(@userid)%></td>
                </tr>
              <% end %>
            </tbody>
          </table>
        <% end %>
<% else %>

    <% if !Opportunity.where(:uid => current_user.id).where(:opid => @opening.id).exists? %>

        <%= link_to "Apply",applyForm_path(@opening)%>

    <% else %>
          <% @check=Opportunity.find_by(uid:current_user.id,opid:@opening.id).status%>
          Status: 
          <% if !@check %>
            Pending
          <% else %>
            Approved
          <% end %>
          <br><br>
          <li><%= link_to "Withdraw", withdraw_path(@opening) %></li>
    <% end %>
<% end %>
